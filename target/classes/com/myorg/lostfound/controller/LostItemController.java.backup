package com.myorg.lostfound.controller;

import com.myorg.lostfound.dto.ApiResponse;
import com.myorg.lostfound.dto.LostItemRequestDto;
import com.myorg.lostfound.dto.LostItemResponseDto;
import com.myorg.lostfound.service.LostItemService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

import javax.validation.Valid;
import java.util.List;

/**
 * REST Controller for LostItem operations
 */
@RestController
@RequestMapping("/api/lost-items")
@CrossOrigin(origins = "*")
public class LostItemController {

    @Autowired
    private LostItemService lostItemService;

    /**
     * Create a new lost item
     */
    @PostMapping
    public ResponseEntity<ApiResponse<LostItemResponseDto>> createLostItem(
            @Valid @RequestBody LostItemRequestDto requestDto) {
        try {
            LostItemResponseDto responseDto = lostItemService.createLostItem(requestDto);
            return ResponseEntity.status(HttpStatus.CREATED)
                    .body(ApiResponse.success("Lost item created successfully", responseDto));
        } catch (Exception e) {
            return ResponseEntity.status(HttpStatus.BAD_REQUEST)
                    .body(ApiResponse.error("Failed to create lost item: " + e.getMessage()));
        }
    }

    /**
     * Get lost item by ID
     */
    @GetMapping("/{id}")
    public ResponseEntity<ApiResponse<LostItemResponseDto>> getLostItemById(@PathVariable Long id) {
        try {
            LostItemResponseDto responseDto = lostItemService.getLostItemById(id);
            return ResponseEntity.ok(ApiResponse.success("Lost item retrieved successfully", responseDto));
        } catch (Exception e) {
            return ResponseEntity.status(HttpStatus.NOT_FOUND)
                    .body(ApiResponse.error("Lost item not found: " + e.getMessage()));
        }
    }

    /**
     * Get all lost items
     */
    @GetMapping
    public ResponseEntity<ApiResponse<List<LostItemResponseDto>>> getAllLostItems() {
        try {
            List<LostItemResponseDto> responseDtos = lostItemService.getAllLostItems();
            return ResponseEntity.ok(ApiResponse.success("Lost items retrieved successfully", responseDtos));
        } catch (Exception e) {
            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR)
                    .body(ApiResponse.error("Failed to retrieve lost items: " + e.getMessage()));
        }
    }

    /**
     * Get lost items by user ID
     */
    @GetMapping("/user/{userId}")
    public ResponseEntity<ApiResponse<List<LostItemResponseDto>>> getLostItemsByUserId(@PathVariable Long userId) {
        try {
            List<LostItemResponseDto> responseDtos = lostItemService.getLostItemsByUserId(userId);
            return ResponseEntity.ok(ApiResponse.success("Lost items retrieved successfully", responseDtos));
        } catch (Exception e) {
            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR)
                    .body(ApiResponse.error("Failed to retrieve lost items: " + e.getMessage()));
        }
    }

    /**
     * Get lost items by category
     */
    @GetMapping("/category/{category}")
    public ResponseEntity<ApiResponse<List<LostItemResponseDto>>> getLostItemsByCategory(@PathVariable String category) {
        try {
            List<LostItemResponseDto> responseDtos = lostItemService.getLostItemsByCategory(category);
            return ResponseEntity.ok(ApiResponse.success("Lost items retrieved successfully", responseDtos));
        } catch (Exception e) {
            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR)
                    .body(ApiResponse.error("Failed to retrieve lost items: " + e.getMessage()));
        }
    }

    /**
     * Get lost items by location
     */
    @GetMapping("/location/{location}")
    public ResponseEntity<ApiResponse<List<LostItemResponseDto>>> getLostItemsByLocation(@PathVariable String location) {
        try {
            List<LostItemResponseDto> responseDtos = lostItemService.getLostItemsByLocation(location);
            return ResponseEntity.ok(ApiResponse.success("Lost items retrieved successfully", responseDtos));
        } catch (Exception e) {
            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR)
                    .body(ApiResponse.error("Failed to retrieve lost items: " + e.getMessage()));
        }
    }

    /**
     * Search lost items by title
     */
    @GetMapping("/search")
    public ResponseEntity<ApiResponse<List<LostItemResponseDto>>> searchLostItemsByTitle(
            @RequestParam String title) {
        try {
            List<LostItemResponseDto> responseDtos = lostItemService.searchLostItemsByTitle(title);
            return ResponseEntity.ok(ApiResponse.success("Search completed successfully", responseDtos));
        } catch (Exception e) {
            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR)
                    .body(ApiResponse.error("Search failed: " + e.getMessage()));
        }
    }

    /**
     * Get recent lost items
     */
    @GetMapping("/recent")
    public ResponseEntity<ApiResponse<List<LostItemResponseDto>>> getRecentLostItems(
            @RequestParam(defaultValue = "7") int days) {
        try {
            List<LostItemResponseDto> responseDtos = lostItemService.getRecentLostItems(days);
            return ResponseEntity.ok(ApiResponse.success("Recent lost items retrieved successfully", responseDtos));
        } catch (Exception e) {
            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR)
                    .body(ApiResponse.error("Failed to retrieve recent lost items: " + e.getMessage()));
        }
    }

    /**
     * Update lost item
     */
    @PutMapping("/{id}")
    public ResponseEntity<ApiResponse<LostItemResponseDto>> updateLostItem(
            @PathVariable Long id,
            @Valid @RequestBody LostItemRequestDto requestDto) {
        try {
            LostItemResponseDto responseDto = lostItemService.updateLostItem(id, requestDto);
            return ResponseEntity.ok(ApiResponse.success("Lost item updated successfully", responseDto));
        } catch (Exception e) {
            return ResponseEntity.status(HttpStatus.BAD_REQUEST)
                    .body(ApiResponse.error("Failed to update lost item: " + e.getMessage()));
        }
    }

    /**
     * Delete lost item
     */
    @DeleteMapping("/{id}")
    public ResponseEntity<ApiResponse<Void>> deleteLostItem(@PathVariable Long id) {
        try {
            lostItemService.deleteLostItem(id);
            return ResponseEntity.ok(ApiResponse.success("Lost item deleted successfully", null));
        } catch (Exception e) {
            return ResponseEntity.status(HttpStatus.NOT_FOUND)
                    .body(ApiResponse.error("Failed to delete lost item: " + e.getMessage()));
        }
    }
}
